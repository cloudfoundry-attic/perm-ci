platform: linux

image_resource:
  type: docker-image
  source:
    repository: cloudfoundry/capi
    tag: ruby-units

inputs:
- name: perm-ci
- name: capi-ci
- name: perm-bin-dir
- name: cloud_controller_ng
- name: version

run:
  path: perm-ci/tasks/test-capi/task.sh

params:
  PERM_TEST_SQL_DB_USERNAME: root
  PERM_TEST_SQL_DB_PASSWORD: password
  # ruby-mysql expects the socket to be at /tmp/mysql.sock
  # but this image puts it in /var/run/mysqld/mysqld.sock
  PERM_TEST_SQL_DB_SOCKET: /var/run/mysqld/mysqld.sock
